# Управление сервером 1С

Для удобства применения все функции работают http методом `GET` и возвращают json объект, как результат работы.

Пример в powershell
```powershell
PS > Invoke-RestMethod -Uri http://10.12.1.117:8315/hs/rac/Clusters/10.12.1.17/1545

ВремяПринудительногоЗавершения                : 0
УровеньОтказоустойчивости                     : 0
УровеньБезопасностиСоединений                 : Незащищенное
РежимБалансировкиНагрузки                     : По производительности
Порт                                          : 1541
ПериодПерезапускаПроцесса                     : 36000
ОграничениеПоПамятиПроцесса                   : 0
ОграничениеПоКоличествуОшибокПроцесса         : 0
МаксимальныйПериодПревышенияПамяти            : 0
ИмяКомпьютера                                 : VERONIKA
Имя                                           : Santens
ИдентификаторКластера                         : 75e25118-be3c-455f-a53d-4a902f1eb256
ЗаписыватьДампПриЗавершенииПоПревышениюПамяти : False
ЗавершатьПроблемныеПроцессы                   : False

ВремяПринудительногоЗавершения                : 120
УровеньОтказоустойчивости                     : 0
УровеньБезопасностиСоединений                 : Незащищенное
РежимБалансировкиНагрузки                     : По памяти
Порт                                          : 1741
ПериодПерезапускаПроцесса                     : 28800
ОграничениеПоПамятиПроцесса                   : 0
ОграничениеПоКоличествуОшибокПроцесса         : 0
МаксимальныйПериодПревышенияПамяти            : 0
ИмяКомпьютера                                 : VERONIKA
Имя                                           : test
ИдентификаторКластера                         : 73da1111-9ed4-427f-bddd-5bf11d85f3ca
ЗаписыватьДампПриЗавершенииПоПревышениюПамяти : False
ЗавершатьПроблемныеПроцессы                   : True
```

## Параметры, используемые в запросах

#### Сервер
IP адрес сервера RAS (`string`)

#### Порт
Порт сервера RAS ([`uInt16`](https://docs.microsoft.com/ru-ru/dotnet/api/system.uint16.maxvalue))

#### Кластер
Наименовение кластера 1С (`string`)

#### База
Наименовение базы данных 1С (`string`)

#### СтатусБлокировки
Флаг запрета установки соединений с базой данных 1С (`string`)
- Lock - заблокированно
- UnLock - разблокированно

#### admin
Логин админа сервера/кластера 1С (`string`), данная учетная запись должна существовать как в настройках сервера 1С так и в настройках кластера 1С либо сервер/кластер не должны использовать контроль доступа (стандартная настройка) 

#### key
Пароль админа сервера/кластера 1С (`string`)

#### login
Логин полномочного пользователя базы данных 1С (`string`) 

#### password
Пароль полномочного пользователя базы данных 1С (`string`)

#### uc
Код разрешения начала сеансов (`string`), аналог дополнительного параметра запуска 1С - `/UC` 

## Функции API

### Получить кластеры сервера 1С
/Clusters/[Сервер](?highlight=Сервер#Сервер)/[Порт](?highlight=Порт#Порт)?[admin](?highlight=admin#admin)&[key](?highlight=key#key)

#### Пример вызова функции

- Запрос
  ```http
  GET /hs/rac/Clusters/10.12.1.17/1545 HTTP/1.1
  User-Agent: HTTPie/1.0.3
  Accept-Encoding: gzip, deflate
  Accept: application/json, */*
  Connection: keep-alive
  Content-Type: application/json
  Host: 10.12.1.117:8315
  ```
  
- Ответ
  ```http
  HTTP/1.1 200 OK
  Connection: Keep-Alive
  Content-Length: 1952
  Content-type: application/json;charset=utf-8
  ```

  - Тело
    ```json
    [{
      "ВремяПринудительногоЗавершения": 0,
      "УровеньОтказоустойчивости": 0,
      "УровеньБезопасностиСоединений": "Незащищенное",
      "РежимБалансировкиНагрузки": "По производительности",
      "Порт": 1541,
      "ПериодПерезапускаПроцесса": 36000,
      "ОграничениеПоПамятиПроцесса": 0,
      "ОграничениеПоКоличествуОшибокПроцесса": 0,
      "МаксимальныйПериодПревышенияПамяти": 0,
      "ИмяКомпьютера": "VERONIKA",
      "Имя": "Santens",
      "ИдентификаторКластера": "75e25118-be3c-455f-a53d-4a902f1eb256",
      "ЗаписыватьДампПриЗавершенииПоПревышениюПамяти": false,
      "ЗавершатьПроблемныеПроцессы": false
     },{
      "ВремяПринудительногоЗавершения": 120,
      "УровеньОтказоустойчивости": 0,
      "УровеньБезопасностиСоединений": "Незащищенное",
      "РежимБалансировкиНагрузки": "По памяти",
      "Порт": 1741,
      "ПериодПерезапускаПроцесса": 28800,
      "ОграничениеПоПамятиПроцесса": 0,
      "ОграничениеПоКоличествуОшибокПроцесса": 0,
      "МаксимальныйПериодПревышенияПамяти": 0,
      "ИмяКомпьютера": "VERONIKA",
      "Имя": "test",
      "ИдентификаторКластера": "73da1111-9ed4-427f-bddd-5bf11d85f3ca",
      "ЗаписыватьДампПриЗавершенииПоПревышениюПамяти": false,
      "ЗавершатьПроблемныеПроцессы": true
    }]
    ```

### Получить базы данных кластера 1С
/Bases/[Сервер](?highlight=Сервер#Сервер)/[Порт](?highlight=Порт#Порт)/[Кластер](?highlight=Кластер#Кластер)?[admin](?highlight=admin#admin)&[key](?highlight=key#key)

#### Пример вызова функции

- Запрос
  ```http
  GET /hs/rac/Bases/10.12.1.17/1545/test HTTP/1.1
  User-Agent: HTTPie/1.0.3
  Accept-Encoding: gzip, deflate
  Accept: application/json, */*
  Connection: keep-alive
  Content-Type: application/json
  Host: 10.12.1.117:8315
  ```

- Ответ
  ```http
  HTTP/1.1 200 OK
  Connection: Keep-Alive
  Content-Length: 78300
  Content-type: application/json;charset=utf-8
  ```
  - Тело
    ```json
    [{
      "БлокировкаРегламентныхЗаданий": false,
      "ВключенаБлокировкаНачалаСеансов": false,
      "ВремяНачалаБлокировки": null,
      "ВремяОкончанияБлокировки": null,
      "ИдентификаторИнформационнойБазы": "a203e032-0ae6-416b-bd49-9d1054f58e9b",
      "Имя": "Test_DO_Pavlov",
      "ИмяБазыДанных": null,
      "КодРазрешенияНачалаСеансов": null,
      "КодЯзыка": null,
      "ОбязательноеИспользованиеВнешнегоУправленияСеансами": false,
      "Описание": null,
      "ПараметрБлокировки": null,
      "ПарольПользователяБазыДанных": null,
      "ПользовательБазыДанных": null,
      "ПрофильБезопасности": null,
      "ПрофильБезопасностиБезопасногоРежима": null,
      "РазрешитьВыдачуЛицензий": false,
      "СерверБазДанных": null,
      "СмещениеДат": null,
      "СоздатьБазуДанных": false,
      "СообщениеБлокировки": null,
      "СтрокаПараметровВнешнегоУправленияСеансами": null,
      "СУБД": null,
      "УровеньБезопасностиСоединений": "Незащищенное"
     },{
      "БлокировкаРегламентныхЗаданий": false,
      "ВключенаБлокировкаНачалаСеансов": false,
      "ВремяНачалаБлокировки": null,
      "ВремяОкончанияБлокировки": null,
      "ИдентификаторИнформационнойБазы": "87c3ee94-f8e7-4bf8-b55b-cb54f9a2a74a",
      "Имя": "test_do_new",
      "ИмяБазыДанных": null,
      "КодРазрешенияНачалаСеансов": null,
      "КодЯзыка": null,
      "ОбязательноеИспользованиеВнешнегоУправленияСеансами": false,
      "Описание": null,
      "ПараметрБлокировки": null,
      "ПарольПользователяБазыДанных": null,
      "ПользовательБазыДанных": null,
      "ПрофильБезопасности": null,
      "ПрофильБезопасностиБезопасногоРежима": null,
      "РазрешитьВыдачуЛицензий": false,
      "СерверБазДанных": null,
      "СмещениеДат": null,
      "СоздатьБазуДанных": false,
      "СообщениеБлокировки": null,
      "СтрокаПараметровВнешнегоУправленияСеансами": null,
      "СУБД": null,
      "УровеньБезопасностиСоединений": "Незащищенное"
    }]
    ```
    
### Получить базу данных кластера 1С
/Bases/[Сервер](?highlight=Сервер#Сервер)/[Порт](?highlight=Порт#Порт)/[Кластер](?highlight=Кластер#Кластер)/[База](?highlight=База#База)?[admin](?highlight=admin#admin)&[key](?highlight=key#key)&[login](?highlight=login#login)&[password](?highlight=password#password)

#### Пример вызова функции

- Запрос
  ```http
  GET /hs/rac/Bases/10.12.1.16/1545/BSS/bss_dev HTTP/1.1
  Accept: application/json, */*;q=0.5
  Accept-Encoding: gzip, deflate
  Connection: keep-alive
  Content-Type: application/json
  Host: 10.12.1.117:8315
  User-Agent: HTTPie/2.4.0
  ```

- Ответ
  ```http
  HTTP/1.1 200 OK
  Connection: Keep-Alive
  Content-Length: 1580
  Content-type: application/json;charset=utf-8
  ```

  - Тело
    ```json
    {
     "БлокировкаРегламентныхЗаданий": false,
     "ВключенаБлокировкаНачалаСеансов": false,
     "ВремяНачалаБлокировки": "2020-11-21T01:31:36",
     "ВремяОкончанияБлокировки": "2020-11-21T01:33:13",
     "ИдентификаторИнформационнойБазы": "4bef5813-a9d1-43d8-9a59-1cb64a422a16",
     "Имя": "bss_dev",
     "ИмяБазыДанных": "bss_dev",
     "КодРазрешенияНачалаСеансов": "709307c0-3955-4416-b1fd-4cb34bf6dd46",
     "КодЯзыка": "ru_RU",
     "ОбязательноеИспользованиеВнешнегоУправленияСеансами": false,
     "Описание": "База разработки BSS",
     "ПараметрБлокировки": "{\"environment\":{\"production\":false}}",
     "ПарольПользователяБазыДанных": "�",
     "ПользовательБазыДанных": "postgres",
     "ПрофильБезопасности": null,
     "ПрофильБезопасностиБезопасногоРежима": null,
     "РазрешитьВыдачуЛицензий": true,
     "СерверБазДанных": "10.12.1.230",
     "СмещениеДат": null,
     "СоздатьБазуДанных": false,
     "СообщениеБлокировки": null,
     "СтрокаПараметровВнешнегоУправленияСеансами": null,
     "СУБД": "PostgreSQL",
     "УровеньБезопасностиСоединений": "Незащищенное"
    }
    ```

### Получить параметр блокировки базы данных 1С
/BaseParams/[Сервер](?highlight=Сервер#Сервер)/[Порт](?highlight=Порт#Порт)/[Кластер](?highlight=Кластер#Кластер)/[База](?highlight=База#База)?[admin](?highlight=admin#admin)&[key](?highlight=key#key)&[login](?highlight=login#login)&[password](?highlight=password#password)

#### Пример вызова функции

- Запрос
  ```http
  GET /hs/rac/BaseParams/10.12.1.16/1545/BSS/bss_dev HTTP/1.1
  Accept: application/json, */*;q=0.5
  Accept-Encoding: gzip, deflate
  Connection: keep-alive
  Content-Type: application/json
  Host: 10.12.1.117:8315
  User-Agent: HTTPie/2.4.0
  ```

- Ответ
  ```http
  HTTP/1.1 200 OK
  Connection: Keep-Alive
  Content-Length: 50
  Content-type: application/json;charset=utf-8
  ```

  - Тело
    ```json
    {
      "environment": {
        "production": false
    } }
    ```

### Установить статус блокировки базы данных 1С
/Bases/[Сервер](?highlight=Сервер#Сервер)/[Порт](?highlight=Порт#Порт)/[Кластер](?highlight=Кластер#Кластер)/[База](?highlight=База#База)/[СтатусБлокировки](?highlight=СтатусБлокировки#СтатусБлокировки)?[admin](?highlight=admin#admin)&[key](?highlight=key#key)&[login](?highlight=login#login)&[password](?highlight=password#password)&[uc](?highlight=uc#uc)

Возвращает параметры информационной базы после выполнения функции

#### Пример вызова функции

- Запрос
  ```http
  GET /hs/rac/Bases/10.12.1.16/1545/BSS/bss_dev/Lock?uc=SecretKey HTTP/1.1
  Accept: application/json, */*;q=0.5
  Accept-Encoding: gzip, deflate
  Connection: keep-alive
  Content-Type: application/json
  Host: 10.12.1.117:8315
  User-Agent: HTTPie/2.4.0
  ```

- Ответ
  ```http
  HTTP/1.1 200 OK
  Connection: Keep-Alive
  Content-Length: 1631
  Content-type: application/json;charset=utf-8
  ```

  - Тело
    ```json
    {
     "БлокировкаРегламентныхЗаданий": true,
     "ВключенаБлокировкаНачалаСеансов": true,
     "ВремяНачалаБлокировки": "2021-02-27T16:17:20",
     "ВремяОкончанияБлокировки": null,
     "ИдентификаторИнформационнойБазы": "4bef5813-a9d1-43d8-9a59-1cb64a422a16",
     "Имя": "bss_dev",
     "ИмяБазыДанных": "bss_dev",
     "КодРазрешенияНачалаСеансов": "SecretKey",
     "КодЯзыка": "ru_RU",
     "ОбязательноеИспользованиеВнешнегоУправленияСеансами": false,
     "Описание": "База разработки BSS",
     "ПараметрБлокировки": "{\"environment\":{\"production\":false}}",
     "ПарольПользователяБазыДанных": "�",
     "ПользовательБазыДанных": "postgres",
     "ПрофильБезопасности": null,
     "ПрофильБезопасностиБезопасногоРежима": null,
     "РазрешитьВыдачуЛицензий": true,
     "СерверБазДанных": "10.12.1.230",
     "СмещениеДат": null,
     "СоздатьБазуДанных": false,
     "СообщениеБлокировки": "База заблокирована для проведения регламентных работ",
     "СтрокаПараметровВнешнегоУправленияСеансами": null,
     "СУБД": "PostgreSQL",
     "УровеньБезопасностиСоединений": "Незащищенное"
    }
    ```

### Завершить сеансы базы данных 1С
/Sessions/[Сервер](?highlight=Сервер#Сервер)/[Порт](?highlight=Порт#Порт)/[Кластер](?highlight=Кластер#Кластер)/[База](?highlight=База#База)/Close?[admin](?highlight=admin#admin)&[key](?highlight=key#key)&[login](?highlight=login#login)&[password](?highlight=password#password)

Даёт команду закрыть все сеансы кроме
- RAS
- BackgroundJob

В ответ выдаёт список сессий, продолжающих существовать, после исполнения функции 

#### Пример вызова функции

- Запрос
  ```http
  GET /hs/rac/Sessions/10.12.1.16/1545/BSS/bss_dev/Close HTTP/1.1
  Accept: application/json, */*;q=0.5
  Accept-Encoding: gzip, deflate
  Connection: keep-alive
  Content-Type: application/json
  Host: 10.12.1.117:8315
  User-Agent: HTTPie/2.4.0
  ```

- Ответ
  ```http
  HTTP/1.1 200 OK
  Connection: Keep-Alive
  Content-Length: 3236
  Content-type: application/json;charset=utf-8
  ```

  - Тело
    ```json
    [{
      "ИмяКомпьютера": "computer",
      "ИмяПользователя": "DefUser",
      "ИмяПриложения": "BackgroundJob",
      "ИмяТекущегоСервиса": "",
      "Лицензии": []
    },{
      "ИмяКомпьютера": "computer",
      "ИмяПользователя": "user",
      "ИмяПриложения": "RAS",
      "ИмяТекущегоСервиса": "",
      "Лицензии": []
    }]
    ```
